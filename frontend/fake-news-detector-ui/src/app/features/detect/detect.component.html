<div class="detect-page">

  <section class="header-box">
    <h2 class="title">Fake News Detection</h2>
    <p class="subtitle">
      Paste a news article or claim below. The model returns a prediction,
      confidence score, and a short note.
    </p>
  </section>

  <section class="card-box">
    <form [formGroup]="form" (ngSubmit)="analyze()">
      <label class="form-label fw-semibold">News / Claim Text</label>

      <textarea
        class="form-control detect-textarea"
        rows="9"
        formControlName="text"
        placeholder="Paste the full news article or claim here..."
      ></textarea>

      <div class="d-flex justify-content-between mt-1">
        <small class="text-muted">Minimum 3 characters required (more is better)</small>
        <small class="text-muted">{{ (textCtrl.value?.length ?? 0) }} characters</small>
      </div>

      <div *ngIf="textCtrl.touched && textCtrl.invalid" class="text-danger small mt-2">
        Please enter at least 3 characters for analysis.
      </div>

      <div class="privacy-note">
        ðŸ”’ Your text is sent only for analysis and is not stored by default.
      </div>

      <div class="d-flex gap-2 flex-wrap mt-3">
        <button class="btn btn-primary px-4" type="submit" [disabled]="loading">
          <ng-container *ngIf="!loading; else loadingTpl">Analyze Text</ng-container>
          <ng-template #loadingTpl>
            <span class="spinner-border spinner-border-sm me-2"></span>
            Analyzing...
          </ng-template>
        </button>

        <button type="button" class="btn btn-outline-success" (click)="loadSample(0)" [disabled]="loading">
          True example
        </button>

        <button type="button" class="btn btn-outline-danger" (click)="loadSample(1)" [disabled]="loading">
          Fake example
        </button>

        <button type="button" class="btn btn-outline-secondary" (click)="clear()" [disabled]="loading">
          Clear
        </button>
      </div>

      <div *ngIf="errorMsg" class="alert alert-danger mt-3 mb-0">
        {{ errorMsg }}
      </div>
    </form>
  </section>

  <!-- Result -->
  <section *ngIf="result" class="card-box result-box">
    <div class="result-header">
      <div>
        <div class="result-label">Prediction</div>

        <!-- One badge (reliable) -->
        <span
          class="badge"
          [ngClass]="{
            'badge-real': result.prediction === 'REAL',
            'badge-fake': result.prediction === 'FAKE',
            'badge-uncertain': result.prediction === 'UNCERTAIN'
          }"
        >
          {{ predictionTitle(result.prediction) }}
        </span>
      </div>

      <div class="confidence">
        <div class="confidence-label">Confidence</div>
        <div class="confidence-value">
          <span *ngIf="result.confidence != null; else naTpl">{{ confidencePercent() }}%</span>
          <ng-template #naTpl>N/A</ng-template>
        </div>
      </div>
    </div>

    <div *ngIf="result.confidence != null" class="progress mt-3">
      <div class="progress-bar" [style.width.%]="confidencePercent()"></div>
    </div>

    <div class="result-note">
      <strong>Note:</strong>
      <span>{{ result.note || 'Model returned a prediction based on learned patterns. Verify with trusted sources.' }}</span>
    </div>

    <div class="disclaimer">
      This tool provides an estimate, not a guarantee. Always cross-check with reliable sources.
    </div>
  </section>

  <section class="card-box tips-box">
    <h4 class="tips-title">Tips for better results</h4>
    <ul>
      <li>Paste full paragraphs instead of just headlines</li>
      <li>Avoid emojis, hashtags, or excessive punctuation</li>
      <li>Include the main claim and surrounding context</li>
    </ul>
  </section>

</div>
